import{u as _,r as c,R as S,j as e,m as L}from"./vendor-BZYaQHyI.js";import{u as R,s as d}from"./index-Db7NAhvY.js";import{H as q,ac as O,a4 as b,k as A}from"./ui-DGJ538yy.js";import"./utils-CsqPS4kC.js";function M(){const{user:a,profile:m,couple:x,signOut:g}=R(),j=_(),[r,s]=c.useState("menu"),[y,f]=c.useState(""),[h,v]=c.useState(""),[n,u]=c.useState(!1),[w,p]=c.useState("");S.useEffect(()=>{m?.couple_id&&x&&(f(x.connect_code),s("created"))},[m,x]);const N=()=>Math.random().toString(36).substring(2,8).toUpperCase(),C=async()=>{u(!0),p("");const t=N();try{const{data:o,error:i}=await d.from("couples").insert([{partner_a:a.id,connect_code:t}]).select().single();if(i)throw i;const{error:l}=await d.from("profiles").update({couple_id:o.id}).eq("id",a.id);if(l)throw l;f(t),s("created"),window.location.reload()}catch(o){console.error("Error creating couple:",o),p(o.message)}finally{u(!1)}},E=async()=>{u(!0),p("");try{const{data:t,error:o}=await d.from("couples").select("*").eq("connect_code",h.toUpperCase()).single();if(o||!t)throw new Error("Invalid code. Please check and try again.");if(t.partner_b)throw new Error("This couple is already full.");if(t.partner_a===a.id)throw new Error("You cannot join your own couple.");const{error:i}=await d.from("couples").update({partner_b:a.id}).eq("id",t.id);if(i)throw i;const{error:l}=await d.from("profiles").update({couple_id:t.id}).eq("id",a.id);if(l)throw l;window.location.reload()}catch(t){console.error("Error joining couple:",t),p(t.message)}finally{u(!1)}},k=async()=>{try{await g(),j("/auth")}catch(t){console.error("Error signing out:",t)}};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("button",{onClick:k,className:"absolute top-6 right-6 text-xs text-white/40 hover:text-white transition-colors",children:"Logout"}),e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-panel w-full max-w-md p-8 rounded-2xl relative",children:[e.jsx("button",{onClick:()=>s("menu"),className:`absolute top-4 left-4 text-xs text-white/50 hover:text-white ${r==="menu"||r==="created"?"hidden":""}`,children:"â† Back"}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-2",children:r==="created"?"Couple Code":"Connect"}),e.jsxs("p",{className:"text-center text-love-100/60 text-sm mb-8",children:[r==="menu"&&"Start a new journey or join your partner.",r==="create"&&"Generate a code to share with your partner.",r==="join"&&"Enter the code shared by your partner.",r==="created"&&"Share this code with your partner."]}),r==="menu"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>s("create"),className:"w-full py-4 px-6 bg-love-600 hover:bg-love-500 rounded-xl font-semibold flex items-center justify-between group transition-all",children:[e.jsx("span",{children:"Start New Couple"}),e.jsx(q,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})]}),e.jsxs("button",{onClick:()=>s("join"),className:"w-full py-4 px-6 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl font-semibold flex items-center justify-between group transition-all text-love-100",children:[e.jsx("span",{children:"I have a code"}),e.jsx(O,{className:"w-5 h-5 group-hover:rotate-12 transition-transform"})]})]}),r==="create"&&e.jsx("div",{className:"space-y-6",children:e.jsx("button",{onClick:C,disabled:n,className:"w-full py-3 bg-white text-black rounded-xl font-bold hover:bg-love-50 transition-colors flex justify-center items-center gap-2",children:n?e.jsx(b,{className:"animate-spin w-4 h-4"}):"Generate Code"})}),r==="created"&&e.jsx("div",{className:"space-y-6 text-center",children:e.jsxs("div",{className:"p-6 bg-black/30 rounded-xl border border-love-500/30 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-4xl font-mono tracking-widest text-love-400",children:y}),e.jsx("p",{className:"text-xs text-white/40",children:"Waiting for partner..."})]})}),r==="join"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("input",{type:"text",placeholder:"ENTER CODE",className:"w-full bg-black/20 border border-white/10 rounded-xl p-4 text-center text-2xl tracking-widest font-mono uppercase focus:outline-none focus:border-love-500 transition-colors",value:h,onChange:t=>v(t.target.value)}),w&&e.jsx("p",{className:"text-red-400 text-xs text-center",children:w}),e.jsxs("button",{onClick:E,disabled:n||h.length<3,className:"w-full py-3 bg-white text-black rounded-xl font-bold hover:bg-love-50 transition-colors flex justify-center items-center gap-2 disabled:opacity-50",children:[n?e.jsx(b,{className:"animate-spin w-4 h-4"}):"Link Partners",!n&&e.jsx(A,{className:"w-4 h-4"})]})]})]})]})}export{M as default};
